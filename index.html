<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwedenFixK Mobile</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #fff);
            --text: var(--tg-theme-text-color, #000);
            --sec: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --accent: #248bed;
        }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .card { background: var(--sec); border-radius: 20px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn { background: var(--accent); color: white; border: none; padding: 12px; border-radius: 12px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid rgba(0,0,0,0.1); box-sizing: border-box; }
        
        #reg-form, #main-ui, #admin-ui { display: none; }
        .admin-item { border-bottom: 1px solid rgba(0,0,0,0.1); padding: 10px 0; }
        .admin-controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-top: 5px; }
        .btn-red { background: #ff4757; }
        .btn-green { background: #2ed573; }
    </style>
</head>
<body>

    <div id="reg-form" class="card">
        <h2>üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <input type="text" id="reg-nick" placeholder="–í–∞—à –Ω–∏–∫–Ω–µ–π–º">
        <select id="reg-role">
            <option value="–ò–≥—Ä–æ–∫">–ò–≥—Ä–æ–∫</option>
            <option value="–ú–µ–Ω–µ–¥–∂–µ—Ä">–ú–µ–Ω–µ–¥–∂–µ—Ä</option>
            <option value="–ö—É—Ä–∞—Ç–æ—Ä">–ö—É—Ä–∞—Ç–æ—Ä</option>
        </select>
        <button class="btn" onclick="submitReg()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    </div>

    <div id="main-ui">
        <div class="card" style="background: linear-gradient(135deg, #6a11cb, #2575fc); color:white;">
            <div id="u-name" style="font-weight: bold;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="u-role" style="font-size: 12px; opacity: 0.8;">–î–æ–ª–∂–Ω–æ—Å—Ç—å</div>
            <h1 id="u-balance">0.00 Gold</h1>
        </div>
        <button class="btn" onclick="tg.close()">–ó–∞–∫—Ä—ã—Ç—å –º–µ–Ω—é</button>
    </div>

    <div id="admin-ui" class="card" style="border: 2px solid #ff4757;">
        <h3 style="color:#ff4757;">‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
        <button class="btn" onclick="refreshList()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ —é–∑–µ—Ä–æ–≤</button>
        <div id="users-container"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        
        const params = new URLSearchParams(window.location.search);
        const userExists = params.get('exists') === 'true';
        const isAdmin = params.get('admin') === 'true';

        // –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if (!userExists) {
            document.getElementById('reg-form').style.display = 'block';
        } else {
            document.getElementById('main-ui').style.display = 'block';
            document.getElementById('u-name').innerText = params.get('nick');
            document.getElementById('u-role').innerText = params.get('role');
            document.getElementById('u-balance').innerText = params.get('balance') + " Gold";
            if (isAdmin) document.getElementById('admin-ui').style.display = 'block';
        }

        function submitReg() {
            const nick = document.getElementById('reg-nick').value;
            const role = document.getElementById('reg-role').value;
            if(!nick) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!");
            tg.sendData(JSON.stringify({action: 'register', nick: nick, role: role}));
        }

        function refreshList() {
            tg.sendData(JSON.stringify({action: 'get_users_list'}));
        }

        function adminAction(tid, type) {
            let amt = 0;
            if (type !== 'reset') {
                amt = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É:");
                if (!amt) return;
            }
            tg.sendData(JSON.stringify({
                action: 'admin_manage',
                target_id: tid,
                type: type,
                amount: parseFloat(amt || 0)
            }));
        }

        // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞ (—Å–ø–∏—Å–æ–∫ —é–∑–µ—Ä–æ–≤)
        // –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –≤ —ç—Ç–æ–º –ø—Ä–∏–º–µ—Ä–µ —Å–ø–∏—Å–æ–∫ –ø—Ä–∏–¥–µ—Ç –≤ —á–∞—Ç –±–æ—Ç–∞ —Ç–µ–∫—Å—Ç–æ–º –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã
    </script>
</body>
</html>
