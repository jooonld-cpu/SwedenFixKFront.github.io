<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; text-align: center; padding: 15px; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 15px; margin: 10px 0; border: 1px solid #ffd700; }
        button { width: 100%; padding: 12px; margin: 5px 0; border: none; border-radius: 8px; background: #ffd700; color: black; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
        input, select { width: 90%; padding: 12px; margin: 8px 0; border-radius: 8px; border: none; background: #333; color: white; }
        .gold { color: #ffd700; font-size: 1.5em; font-weight: bold; }
    </style>
</head>
<body>

    <div id="main-menu">
        <h2>–°–ø—Ä–∞–≤–æ—á–Ω–∞—è –®–≤–µ—Ü–∏–∏</h2>
        <div class="card">
            <p id="info-text"></p>
        </div>
        <button onclick="window.open('https://docs.google.com/document/d/1CtUNPBjuuo-twrqvRVmm0YhRizTwmP5xTh8G9xNwmzU/edit', '_blank')">üìú –ó–∞–∫–æ–Ω—ã</button>
        <button onclick="showFinance()">üè¶ –§–∏–Ω–∞–Ω—Å—ã (–ë–∞–Ω–∫–∏)</button>
    </div>

    <div id="bank-page" class="hidden">
        <h2>–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ë–∞–Ω–∫ –®–≤–µ—Ü–∏–∏</h2>
        <div class="card">
            <p>–ë–∞–ª–∞–Ω—Å:</p>
            <p class="gold"><span id="val-balance"></span> GOLD</p>
        </div>
        <button onclick="showTransfer()">üí∏ –ü–µ—Ä–µ–≤–æ–¥ –∏–≥—Ä–æ–∫—É</button>
        <button onclick="showWithdraw()">üì• –°–Ω—è—Ç–∏–µ —Å—Ä–µ–¥—Å—Ç–≤</button>
        <button onclick="location.reload()" style="background: #555; color: white;">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="transfer-page" class="hidden">
        <h2>–ü–µ—Ä–µ–≤–æ–¥ GOLD</h2>
        <select id="user-select"></select>
        <input type="number" id="t-amount" placeholder="–°—É–º–º–∞">
        <button onclick="sendAction('transfer')" style="background: #28a745; color: white;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        <button onclick="showFinance()" style="background: #555; color: white;">–û—Ç–º–µ–Ω–∞</button>
    </div>

    <div id="withdraw-page" class="hidden">
        <h2>–°–Ω—è—Ç–∏–µ GOLD</h2>
        <p>–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–≤–æ–¥–∞ –Ω–∞–ª–∏—á–Ω—ã–º–∏:</p>
        <input type="number" id="w-amount" placeholder="–°—É–º–º–∞">
        <button onclick="sendAction('withdraw')" style="background: #e67e22; color: white;">–ó–∞–ø—Ä–æ—Å–∏—Ç—å —Å–Ω—è—Ç–∏–µ</button>
        <button onclick="showFinance()" style="background: #555; color: white;">–û—Ç–º–µ–Ω–∞</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const params = new URLSearchParams(window.location.search);

        if (params.get('exists') === 'true') {
            document.getElementById('info-text').innerText = params.get('nick') + " | " + params.get('role');
            document.getElementById('val-balance').innerText = params.get('balance');
            
            const select = document.getElementById('user-select');
            (params.get('users') || "").split(',').forEach(u => {
                if(u) {
                    const [id, name] = u.split(':');
                    const opt = document.createElement('option');
                    opt.value = id; opt.text = name;
                    select.appendChild(opt);
                }
            });
        }

        function showFinance() {
            hideAll();
            document.getElementById('bank-page').classList.remove('hidden');
        }

        function showTransfer() {
            hideAll();
            document.getElementById('transfer-page').classList.remove('hidden');
        }

        function showWithdraw() {
            hideAll();
            document.getElementById('withdraw-page').classList.remove('hidden');
        }

        function sendAction(act) {
            let amount, target;
            if(act === 'transfer') {
                amount = document.getElementById('t-amount').value;
                target = document.getElementById('user-select').value;
            } else {
                amount = document.getElementById('w-amount').value;
            }

            if(!amount || amount <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É!");

            tg.sendData(JSON.stringify({
                action: act,
                amount: parseFloat(amount),
                target_id: target || ""
            }));
            tg.close();
        }

        function hideAll() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('bank-page').classList.add('hidden');
            document.getElementById('transfer-page').classList.add('hidden');
            document.getElementById('withdraw-page').classList.add('hidden');
        }
    </script>
</body>
</html>
