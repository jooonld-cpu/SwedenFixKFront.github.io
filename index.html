<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweden Cabinet</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffd700; --bg: #1a1a1a; --card: #2d2d2d; --text: #eeeeee; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 12px; border-left: 4px solid var(--gold); }
        button { width: 100%; padding: 14px; margin: 5px 0; border: none; border-radius: 10px; background: var(--gold); color: black; font-weight: bold; cursor: pointer; }
        .btn-sec { background: #444; color: white; }
        input, select { width: 100%; padding: 12px; margin: 10px 0; border-radius: 8px; background: #333; color: white; border: 1px solid #444; box-sizing: border-box; }
        .hidden { display: none; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    </style>
</head>
<body>

<div id="main-menu">
    <h2 id="u-nick">...</h2>
    <div id="u-role" style="opacity: 0.6; margin-bottom: 20px;">...</div>
    
    <div class="grid">
        <button onclick="showPage('page-finance')">üí∞ –°—á–µ—Ç–∞</button>
        <button onclick="showPage('page-bonds')">üìà –ë—É–º–∞–≥–∏</button>
        <button onclick="showPage('page-transfer')">üí∏ –ò–≥—Ä–æ–∫—É</button>
        <button onclick="showPage('page-bank-move')">üîÑ –ú–µ–∂–¥—É –ë–ö</button>
    </div>
</div>

<div id="page-finance" class="hidden">
    <h3>–ú–æ–∏ –±–∞–ª–∞–Ω—Å—ã</h3>
    <div id="accs-container"></div>
    <button class="btn-sec" onclick="showPage('main-menu')">–ù–∞–∑–∞–¥</button>
</div>

<div id="page-bank-move" class="hidden">
    <h3>–ü–µ—Ä–µ–≤–æ–¥ –º–µ–∂–¥—É —Å–≤–æ–∏–º–∏ –±–∞–Ω–∫–∞–º–∏</h3>
    <label>–û—Ç–∫—É–¥–∞:</label>
    <select id="move-from"></select>
    <label>–ö—É–¥–∞ (ID –±–∞–Ω–∫–∞):</label>
    <input type="number" id="move-to-id" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1">
    <input type="number" id="move-amount" placeholder="–°—É–º–º–∞">
    <button onclick="bankMove()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
    <button class="btn-sec" onclick="showPage('main-menu')">–ù–∞–∑–∞–¥</button>
</div>

<div id="page-bonds" class="hidden">
    <h3>–û–±–ª–∏–≥–∞—Ü–∏–∏</h3>
    <div id="bonds-list"></div>
    <hr>
    <select id="b-type">
        <option value="–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –û–±–ª–∏–≥–∞—Ü–∏—è">–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è (1.5%)</option>
        <option value="–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è –û–±–ª–∏–≥–∞—Ü–∏—è">–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è (1.0%)</option>
    </select>
    <input type="number" id="b-amount" placeholder="–°—É–º–º–∞ –ø–æ–∫—É–ø–∫–∏">
    <button onclick="buyBond()">–ö—É–ø–∏—Ç—å —á–µ—Ä–µ–∑ —Ç–µ–∫—É—â–∏–π —Å—á–µ—Ç</button>
    <button class="btn-sec" onclick="showPage('main-menu')">–ù–∞–∑–∞–¥</button>
</div>

<div id="page-transfer" class="hidden">
    <h3>–ü–µ—Ä–µ–≤–æ–¥ –∏–≥—Ä–æ–∫—É</h3>
    <select id="u-select"></select>
    <input type="number" id="t-amount" placeholder="–°—É–º–º–∞">
    <button onclick="playerTransfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <button class="btn-sec" onclick="showPage('main-menu')">–ù–∞–∑–∞–¥</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    let params = new URLSearchParams(window.location.search);

    function showPage(id) {
        ['main-menu','page-finance','page-bonds','page-transfer', 'page-bank-move'].forEach(p => document.getElementById(p).classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function load() {
        document.getElementById('u-nick').innerText = decodeURIComponent(params.get('nick') || "–ñ–∏—Ç–µ–ª—å");
        document.getElementById('u-role').innerText = decodeURIComponent(params.get('role') || "");

        const accs = JSON.parse(decodeURIComponent(params.get('accounts') || "[]"));
        const cont = document.getElementById('accs-container');
        const mFrom = document.getElementById('move-from');
        accs.forEach(a => {
            cont.innerHTML += `<div class="card"><b>${a.bank_name}</b> (ID: ${a.bank_id})<br><h2>${a.balance.toFixed(2)} GOLD</h2></div>`;
            mFrom.add(new Option(a.bank_name, a.bank_id));
        });

        const bonds = JSON.parse(decodeURIComponent(params.get('bonds') || "[]"));
        const bList = document.getElementById('bonds-list');
        bonds.forEach(b => {
            bList.innerHTML += `<div class="card"><b>${b.name}</b><br>–ö—É–ø–ª–µ–Ω–æ: ${b.amount}<br>üí∞ –ö –≤—ã–¥–∞—á–µ: ${b.current_value.toFixed(2)}</div>`;
        });

        const users = decodeURIComponent(params.get('users') || "").split(',');
        const uSel = document.getElementById('u-select');
        users.forEach(u => { if(u.includes(':')) uSel.add(new Option(u.split(':')[1], u.split(':')[0])); });
    }

    function bankMove() {
        tg.sendData(JSON.stringify({
            action: 'bank_transfer',
            bank_id: parseInt(document.getElementById('move-from').value),
            target_id: document.getElementById('move-to-id').value,
            amount: parseFloat(document.getElementById('move-amount').value)
        }));
    }

    function buyBond() {
        tg.sendData(JSON.stringify({
            action: 'bond_request',
            bond_name: document.getElementById('b-type').value,
            amount: parseFloat(document.getElementById('b-amount').value),
            bank_id: parseInt(document.getElementById('move-from').value)
        }));
    }

    load();
</script>
</body>
</html>
