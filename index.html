<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweden Finance</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffd700; --bg: #1a1a1a; --card: #2d2d2d; --text: #eeeeee; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--gold); }
        .hidden { display: none; }
        button { width: 100%; padding: 12px; background: var(--gold); border: none; border-radius: 8px; font-weight: bold; margin: 5px 0; }
        #loader { text-align: center; padding-top: 50px; }
    </style>
</head>
<body>
    <div id="loader">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <div id="main-menu" class="hidden">
        <h2 id="u-nick">–ù–∏–∫</h2>
        <p id="u-role" style="opacity:0.7">–†–æ–ª—å</p>
        <div class="card">
            <small>–ë–∞–ª–∞–Ω—Å:</small>
            <h1 id="bal-val">0.00 GOLD</h1>
        </div>
        <button onclick="showPage('page-transfer')">üí∏ –ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
        <button onclick="tg.close()">–í—ã—Ö–æ–¥</button>
    </div>

    <div id="page-transfer" class="hidden">
        <h3>–ü–µ—Ä–µ–≤–æ–¥</h3>
        <select id="u-select" style="width:100%; padding:10px; margin-bottom:10px;"></select>
        <input type="number" id="t-amount" placeholder="–°—É–º–º–∞" style="width:100%; padding:10px; margin-bottom:10px;">
        <button onclick="doTransfer()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button onclick="showPage('main-menu')" style="background:#444; color:#fff;">–ù–∞–∑–∞–¥</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const params = new URLSearchParams(window.location.search);

        // –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
        function cleanParam(name) {
            let val = params.get(name) || "";
            return decodeURIComponent(val).replace(/[\u00A0\u1680‚Äã\u180e\u2000-\u200b\u202f\u205f\u3000]/g, " ");
        }

        function showPage(id) {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('page-transfer').classList.add('hidden');
            document.getElementById(id).classList.remove('hidden');
        }

        function load() {
            try {
                document.getElementById('u-nick').innerText = cleanParam('nick') || "–ñ–∏—Ç–µ–ª—å";
                document.getElementById('u-role').innerText = cleanParam('role') || "–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω";

                // –ü–∞—Ä—Å–∏–º —Å—á–µ—Ç–∞
                const accs = JSON.parse(cleanParam('accounts') || "[]");
                if(accs.length > 0) {
                    document.getElementById('bal-val').innerText = accs[0].balance.toFixed(2) + " GOLD";
                }

                // –ü–∞—Ä—Å–∏–º –∏–≥—Ä–æ–∫–æ–≤
                const users = cleanParam('users').split(',');
                const uSel = document.getElementById('u-select');
                users.forEach(u => {
                    if(u.includes(':')) {
                        const [id, name] = u.split(':');
                        uSel.add(new Option(name, id));
                    }
                });

                document.getElementById('loader').classList.add('hidden');
                showPage('main-menu');
            } catch (e) {
                document.getElementById('loader').innerText = "‚ùå –û—à–∏–±–∫–∞ –¥–∞–Ω–Ω—ã—Ö: " + e.message;
            }
        }

        function doTransfer() {
            const amount = parseFloat(document.getElementById('t-amount').value);
            const target = document.getElementById('u-select').value;
            if(!amount || !target) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è");
            tg.sendData(JSON.stringify({action: 'transfer', amount: amount, target_id: target}));
        }

        load();
    </script>
</body>
</html>
