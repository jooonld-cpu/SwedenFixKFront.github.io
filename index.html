<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–®–≤–µ—Ü–∏—è: –ö–∞–±–∏–Ω–µ—Ç</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; text-align: center; padding: 20px; color: #333; }
        .hidden { display: none; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 20px; }
        button { width: 100%; padding: 12px; margin: 8px 0; border: none; border-radius: 8px; background: #00529b; color: white; font-weight: bold; cursor: pointer; }
        button:active { background: #003d73; }
        .bank-info { color: #28a745; font-size: 1.2em; font-weight: bold; }
    </style>
</head>
<body>

    <div id="reg-screen" class="hidden">
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥—Ä–∞–∂–¥–∞–Ω–∏–Ω–∞</h2>
        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ—Å—å —Å–∏—Å—Ç–µ–º–µ</p>
        <input type="text" id="nick" placeholder="–í–∞—à –ù–∏–∫" style="width: 80%; padding: 10px; margin-bottom: 10px;">
        <select id="role" style="width: 85%; padding: 10px; margin-bottom: 10px;">
            <option value="–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω">–ì—Ä–∞–∂–¥–∞–Ω–∏–Ω</option>
            <option value="–°–æ—Ç—Ä—É–¥–Ω–∏–∫">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</option>
            <option value="–ú–∏–Ω–∏—Å—Ç—Ä">–ú–∏–Ω–∏—Å—Ç—Ä</option>
        </select>
        <button onclick="register()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    </div>

    <div id="main-menu" class="hidden">
        <h2>–ï–¥–∏–Ω–∞—è —Å–ø—Ä–∞–≤–æ—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –®–≤–µ—Ü–∏–∏</h2>
        <div class="card">
            <p><strong>–ù–∏–∫:</strong> <span id="user-nick"></span></p>
            <p><strong>–î–æ–ª–∂–Ω–æ—Å—Ç—å:</strong> <span id="user-role"></span></p>
        </div>
        
        <button onclick="openLaws()">üìú –ó–∞–∫–æ–Ω—ã</button>
        <button onclick="alert('–†–∞–∑–¥–µ–ª –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ')">üìù –ó–∞—è–≤–ª–µ–Ω–∏—è</button>
        <button onclick="showFinance()">üí∞ –§–∏–Ω–∞–Ω—Å—ã</button>
    </div>

    <div id="finance-screen" class="hidden">
        <h2>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–π —Å–µ–∫—Ç–æ—Ä</h2>
        <button onclick="showNBSh()">–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ë–∞–Ω–∫ –®–≤–µ—Ü–∏–∏ (–ù–ë–®)</button>
        
        <div id="bank-detail" class="hidden card">
            <p>–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å:</p>
            <p class="bank-info"><span id="user-balance"></span> SEK</p>
        </div>
        
        <button onclick="backToMenu()" style="background: #6c757d; margin-top: 20px;">‚¨ÖÔ∏è –ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ Go-–±–æ—Ç–æ–º
        const params = new URLSearchParams(window.location.search);
        const exists = params.get('exists');
        const nick = params.get('nick');
        const role = params.get('role');
        const balance = params.get('balance');

        // –†–µ—à–∞–µ–º, –∫–∞–∫–æ–π —ç–∫—Ä–∞–Ω –ø–æ–∫–∞–∑–∞—Ç—å
        if (exists === 'true') {
            document.getElementById('main-menu').classList.remove('hidden');
            document.getElementById('user-nick').innerText = nick;
            document.getElementById('user-role').innerText = role;
        } else {
            document.getElementById('reg-screen').classList.remove('hidden');
        }

        // --- –§–£–ù–ö–¶–ò–ò ---

        function register() {
            const nickInput = document.getElementById('nick').value;
            const roleInput = document.getElementById('role').value;
            if(!nickInput) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!");
            
            const data = { action: 'register', nick: nickInput, role: roleInput };
            tg.sendData(JSON.stringify(data));
            tg.close();
        }

        function openLaws() {
            // –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à Google –î–æ–∫—É–º–µ–Ω—Ç
            window.open("https://docs.google.com/document/d/1CtUNPBjuuo-twrqvRVmm0YhRizTwmP5xTh8G9xNwmzU/edit?tab=t.0", "_blank");
        }

        function showFinance() {
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('finance-screen').classList.remove('hidden');
        }

        function showNBSh() {
            document.getElementById('bank-detail').classList.remove('hidden');
            document.getElementById('user-balance').innerText = balance;
        }

        function backToMenu() {
            document.getElementById('finance-screen').classList.add('hidden');
            document.getElementById('bank-detail').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
        }
    </script>
</body>
</html>
