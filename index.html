<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwedenFixK Admin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg: var(--tg-theme-bg-color, #fff);
            --text: var(--tg-theme-text-color, #000);
            --accent: #248bed;
            --secondary: var(--tg-theme-secondary-bg-color, #f4f4f5);
        }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .card { background: var(--secondary); border-radius: 15px; padding: 15px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .btn { background: var(--accent); color: white; border: none; padding: 10px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
        .admin-only { display: none; border: 2px solid #ff4757; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
        th, td { padding: 8px; border-bottom: 1px solid rgba(0,0,0,0.1); text-align: left; }
        .controls { display: flex; gap: 5px; margin-top: 10px; }
        .btn-sm { padding: 5px; font-size: 10px; flex: 1; }
    </style>
</head>
<body>
    <div class="card">
        <h2 id="user-nick">–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
        <p>–ë–∞–ª–∞–Ω—Å: <b id="user-balance">0</b> Gold</p>
        <button class="btn" onclick="openWithdraw()">üìâ –°–Ω—è—Ç—å Gold</button>
    </div>

    <div id="admin-section" class="card admin-only">
        <h3>‚öôÔ∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
        <div id="users-list">–ù–∞–∂–º–∏—Ç–µ ¬´–û–±–Ω–æ–≤–∏—Ç—å¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫</div>
        <button class="btn" style="background:#2ed573; margin-top:10px;" onclick="refreshUsers()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const urlParams = new URLSearchParams(window.location.search);
        const isAdmin = urlParams.get('admin') === 'true';
        const balance = urlParams.get('balance') || "0";

        document.getElementById('user-balance').innerText = balance;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî –∞–¥–º–∏–Ω
        if (isAdmin) {
            document.getElementById('admin-section').style.display = 'block';
        }

        function refreshUsers() {
            tg.sendData(JSON.stringify({action: 'get_users_list'}));
        }

        function openWithdraw() {
            let amt = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è —Å–Ω—è—Ç–∏—è:");
            if(amt) tg.sendData(JSON.stringify({action: 'withdraw', amount: parseFloat(amt)}));
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–¥–º–∏–Ω–∞: –∏–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
        function manageUser(tid, nick) {
            let action = prompt(`–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ${nick}:\n1 - –ü–æ–ø–æ–ª–Ω–∏—Ç—å\n2 - –°–Ω—è—Ç—å\n–í–≤–µ–¥–∏—Ç–µ 1 –∏–ª–∏ 2:`);
            let amt = prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É:");
            if (action && amt) {
                tg.sendData(JSON.stringify({
                    action: 'admin_manage',
                    target_id: tid,
                    type: action === '1' ? 'add' : 'sub',
                    amount: parseFloat(amt)
                }));
            }
        }
    </script>
</body>
</html>
