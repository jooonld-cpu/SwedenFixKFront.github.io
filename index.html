<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweden Kabinet</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #ffd700; --bg: #1a1a1a; --card: #2d2d2d; --text: #eee; }
        body { font-family: sans-serif; background: var(--bg); color: var(--text); padding: 15px; margin: 0; }
        .card { background: var(--card); padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--gold); }
        .info-line { background: #333; padding: 10px; font-size: 13px; border-radius: 8px; margin-bottom: 20px; color: var(--gold); text-align: center; }
        input, select { width: 100%; padding: 12px; margin: 5px 0; border-radius: 8px; border: none; background: #444; color: #fff; box-sizing: border-box;}
        button { width: 100%; padding: 12px; background: var(--gold); border: none; border-radius: 8px; font-weight: bold; margin: 5px 0; color: #000; }
        .hidden { display: none; }
        h2, h3 { margin: 5px 0; }
    </style>
</head>
<body>
    <div id="loader">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã...</div>

    <div id="reg-screen" class="hidden">
        <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
        <input type="text" id="reg-nick" placeholder="–í–∞—à –Ω–∏–∫">
        <input type="text" id="reg-role" placeholder="–í–∞—à–∞ –¥–æ–ª–∂–Ω–æ—Å—Ç—å">
        <button onclick="register()">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
    </div>

    <div id="main-screen" class="hidden">
        <div class="info-line" id="info-text">–ò–Ω—Ñ–æ-—Å—Ç—Ä–æ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>
        
        <div class="header">
            <h2 id="u-nick">–ù–∏–∫–Ω–µ–π–º</h2>
            <p id="u-role" style="opacity: 0.7">–î–æ–ª–∂–Ω–æ—Å—Ç—å</p>
        </div>

        <div class="card">
            <small>–í–∞—à –±–∞–ª–∞–Ω—Å:</small>
            <h1 id="u-bal">0.00 GOLD</h1>
        </div>

        <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
        <button onclick="showSection('transfer')">üí∏ –ü–µ—Ä–µ–≤–æ–¥ –∏–≥—Ä–æ–∫—É</button>
        <button onclick="showSection('withdraw')">üè¶ –°–Ω—è—Ç–∏–µ —Å—Ä–µ–¥—Å—Ç–≤</button>
        <button onclick="showSection('invest')">üìà –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ (–û–±–ª–∏–≥–∞—Ü–∏–∏)</button>
        
        <button onclick="tg.close()" style="background: #444; color: #fff; margin-top: 20px;">–í—ã–π—Ç–∏</button>
    </div>

    <div id="transfer-screen" class="hidden">
        <h3>–ü–µ—Ä–µ–≤–æ–¥ –∏–≥—Ä–æ–∫—É</h3>
        <input type="text" id="t-id" placeholder="ID –∏–≥—Ä–æ–∫–∞">
        <input type="number" id="t-sum" placeholder="–°—É–º–º–∞">
        <button onclick="doAction('transfer')">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <button onclick="showSection('main')">–ù–∞–∑–∞–¥</button>
    </div>

    <div id="invest-screen" class="hidden">
        <h3>–ú–æ–∏ –æ–±–ª–∏–≥–∞—Ü–∏–∏</h3>
        <div id="bonds-list"></div>
        <button onclick="showSection('main')">–ù–∞–∑–∞–¥</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        const params = new URLSearchParams(window.location.search);

        function register() {
            const n = document.getElementById('reg-nick').value;
            const r = document.getElementById('reg-role').value;
            tg.sendData(JSON.stringify({action: 'register', nick: n, role: r}));
        }

        function showSection(name) {
            document.querySelectorAll('div[id$="-screen"]').forEach(d => d.classList.add('hidden'));
            document.getElementById(name + '-screen').classList.remove('hidden');
        }

        function doAction(act) {
            const tid = document.getElementById('t-id').value;
            const sum = parseFloat(document.getElementById('t-sum').value);
            tg.sendData(JSON.stringify({
                action: act, 
                target_id: tid, 
                amount: sum,
                nick: decodeURIComponent(params.get('nick'))
            }));
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = () => {
            const exists = params.get('exists') === 'true';
            document.getElementById('loader').classList.add('hidden');

            if (!exists) {
                document.getElementById('reg-screen').classList.remove('hidden');
            } else {
                document.getElementById('main-screen').classList.remove('hidden');
                document.getElementById('u-nick').innerText = decodeURIComponent(params.get('nick'));
                document.getElementById('u-role').innerText = decodeURIComponent(params.get('role'));
                document.getElementById('u-bal').innerText = params.get('bal') + " GOLD";
                document.getElementById('info-text').innerText = decodeURIComponent(params.get('info') || "–ù–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π");
                
                // –†–µ–Ω–¥–µ—Ä –æ–±–ª–∏–≥–∞—Ü–∏–π
                const bonds = JSON.parse(decodeURIComponent(params.get('bonds') || "[]"));
                const list = document.getElementById('bonds-list');
                bonds.forEach(b => {
                    list.innerHTML += `<div class="card">
                        <b>${b.name}</b><br>
                        –°—É–º–º–∞: ${b.current_value.toFixed(2)} GOLD<br>
                        –°—Ç–∞–≤–∫–∞: ${b.rate}%/–¥–µ–Ω—å<br>
                        <small>–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏: ${b.date}</small>
                    </div>`;
                });
            }
        };
    </script>
</body>
</html>
